<!DOCTYPE html>
<html lang="en">

<head>
  <title>BookD</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="format-detection" content="telephone=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="author" content="TemplatesJungle">
  <meta name="keywords" content="ecommerce,fashion,store">
  <meta name="description" content="Bootstrap 5 Fashion Store HTML CSS Template">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="/css/vendor.css">
  <link rel="stylesheet" href="/https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css" />
  <link rel="stylesheet" type="text/css" href="/style.css">

  <link rel="preconnect" href="/https://fonts.googleapis.com">
  <link rel="preconnect" href="/https://fonts.gstatic.com" crossorigin>
  <link href="/https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
  <link
    href="/https://fonts.googleapis.com/css2?family=Jost:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&family=Marcellus&display=swap"
    rel="stylesheet">
    <link rel="stylesheet" href="/https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
    
    <style>
      div.swiper-wrapper {
  height: 80%;
 /* Profile Form Styles */

}
.profile-container {
    max-width: 600px; /* Limits form width */
    background: #fff; /* White background */
    padding: 10px;
    border-radius: 8px; /* Rounded corners */
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* Soft shadow */
    margin: 30px auto; /* Center align */
}

/* Input fields */
.profile-container .form-control {
    border-radius: 6px;
    padding: 10px;
    font-size: 14px;
}

/* Labels */
.profile-container .form-label {
    font-weight: 600;
    color: #333;
}

/* Button styling */
.profile-container .btn-primary {
    padding: 10px 20px;
    font-size: 16px;
    font-weight: 600;
    border-radius: 6px;
}

/* Center align the button */
.profile-container .form-footer {
    display: flex;
    justify-content: center; /* Centers button horizontally */
    margin-top: 15px; /* Adds space above the button */
}


/* Responsive adjustments */
@media (max-width: 768px) {
    .profile-container {
        padding: 15px;
    }
}

  </style>
</head>

<%-include("../../views/partials/user/header")%>

<div class="container mt-4">
    <div class="row">
        
        <div  class="profile-container">
        <form id="profileDetailsForm" >
            <div class="mb-3">
                <label class="form-label">Full Name</label>
                <input type="text" name="fullName" class="form-control" value="<%= user.name || '' %>" >
            </div>

            <!-- Email (Readonly) -->
            <div class="mb-3">
                <label class="form-label">Email</label>
                <input type="email" class="form-control" value="<%= user.email %>" readonly>
            </div>

            <!-- Phone -->
            <div class="mb-3">
                <label class="form-label">Phone</label>
                <input type="text" name="phone" class="form-control" value="<%= user.phone || '' %>" >
            </div>
            <!-- City -->
            <div class="mb-3">
                <label class="form-label">City</label>
                <input type="text" name="city" id="city" class="form-control" value="<%= user.city || '' %>" >
            </div>
            <!-- State -->
            <div class="mb-3">
                <label class="form-label">State</label>
                <input type="text" name="state" id="state" class="form-control" value="<%= user.state || '' %>" >
            </div>
            <!-- Place -->
            <div class="mb-3">
                <label class="form-label">Place</label>
                <input type="text" name="place" id="place" class="form-control" value="<%= user.place || '' %>" >
            </div>
            <!-- Pincode -->
            <div class="mb-3">
                <label class="form-label">PIN</label>
                <input type="number" name="pincode" id="pincode" class="form-control" value="<%= user.pincode || '' %>" >
            </div>

            <!-- Address -->
            <div class="mb-3">
                <label class="form-label">Address</label>
                <textarea name="address" class="form-control" rows="3" required><%= user.address || '' %></textarea>
            </div>


            <div class="text-end form-footer">
                <button type="submit" class="btn btn-primary ">Edit Address</button>
            </div>
        </form>
    </div>
        </div>
    </div>
        
    <%-include("../../views/partials/user/footer")%>
          <script src="/js/jquery.min.js"></script>
          <script src="/js/plugins.js"></script>
          <script src="/js/SmoothScroll.js"></script>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
          <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
            crossorigin="anonymous"></script>
          <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
          <script src="/js/script.min.js"></script>
          <!-- SweetAlert2 CDN -->
          

          <script>
           document.addEventListener('DOMContentLoaded',function(){
            initClearSearch()
            editaddress()
           })
           
           function initClearSearch() {
             const clearBtn = document.getElementById("clear-search");
               const searchInput = document.getElementById("search-form");
                if (clearBtn && searchInput) {
              clearBtn.addEventListener("click", function () {
              searchInput.value = "";
            window.location.href = "/shop";
                });
             }
        }
         function editaddress(){
            const form = document.getElementById("profileDetailsForm");

    form.addEventListener("submit", function (event) {
        event.preventDefault(); 


        
        const phone = form.phone.value.trim();
        const pincode = form.pincode.value.trim();
        const fullName = form.fullName.value.trim();
        const city = form.city.value.trim();
        const state = form.state.value.trim();
        const place = form.place.value.trim();
        const address = form.address.value.trim();

        const phoneRegex = /^[6-9]\d{9}$/; 
        const pincodeRegex = /^\d{6}$/;

        if (!fullName || !city || !state || !place || !address) {
            alert("Please fill in all required fields.");
            return;
        }

        if (!phoneRegex.test(phone)) {
            alert("Please enter a valid 10-digit phone number.");
            return;
        }

        if (!pincodeRegex.test(pincode)) {
            alert("Please enter a valid 6-digit PIN code.");
            return;
        }

        
        const formData = new FormData(form);
        const jsonData = {};
        
        formData.forEach((value, key) => {
            jsonData[key] = value;
        });

        
        fetch("/profile/address", {
            method: "PATCH", 
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(jsonData) 
        })
        .then(response => response.json())
        .then(data => {
            if (data.redirectTo) {
                alert("Profile updated successfully!");
                window.location.href = data.redirectTo;
            } else {
                alert("Error updating profile. Please try again.");
            }
        })
        .catch(error => {
            console.error("Error:", error);
            alert("Something went wrong.");
        });
    });
         }


          </script>
        
        </body>
        
        </html>


    